
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Embedded Objects &mdash; django-mongodb-engine v0.2.0 documentation</title>
    <link rel="stylesheet" href="static/nature.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <link rel="top" title="django-mongodb-engine v0.2.0 documentation" href="index.html" />
    <link rel="next" title="Storing Python Lists and Dicts" href="lists-and-dicts.html" />
    <link rel="prev" title="django-mongodb-engine – MongoDB Backend for Django" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="lists-and-dicts.html" title="Storing Python Lists and Dicts"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="django-mongodb-engine – MongoDB Backend for Django"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">django-mongodb-engine v0.2.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
          <div class="body">
            
  <div class="section" id="embedded-objects">
<h1>Embedded Objects<a class="headerlink" href="#embedded-objects" title="Permalink to this headline">¶</a></h1>
<p>django-mongodb-engine supports <a class="reference external" href="http://www.mongodb.org/display/DOCS/Dot+Notation+%28Reaching+into+Objects%29">MongoDB&#8217;s embedded objects</a>.</p>
<div class="toctree-wrapper compound">
<ul class="simple">
</ul>
</div>
<div class="section" id="simple-embedding">
<span id="id1"></span><h2>Simple Embedding<a class="headerlink" href="#simple-embedding" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Using <tt class="xref py py-class docutils literal"><span class="pre">EmbeddedModelField</span></tt>, you can embed
any Django model in other models:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">djangotoobox.fields</span> <span class="kn">import</span> <span class="n">EmbeddedModelField</span>

<span class="k">class</span> <span class="nc">ModelA</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
   <span class="n">b</span> <span class="o">=</span> <span class="n">EmbeddedModelField</span><span class="p">(</span><span class="n">ModelB</span><span class="p">)</span> <span class="c"># or &#39;B&#39; (in quotes)</span>
</pre></div>
</div>
</div>
<p>With <tt class="xref py py-class docutils literal"><span class="pre">EmbeddedModelField</span></tt>, which was originally
written for <em>django-mongodb-engine</em> and then merged into <cite>djangotoolbox</cite>,
you can embed any Django model into another model. Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">djangotoolbox</span> <span class="kn">import</span> <span class="n">fields</span>

<span class="k">class</span> <span class="nc">Customer</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>
    <span class="n">address</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">EmbeddedModelField</span><span class="p">(</span><span class="s">&#39;Address&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Address</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">city</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>
    <span class="n">street</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>
</pre></div>
</div>
<p>Similar to relation definitions, the model passed to
<tt class="xref py py-class docutils literal"><span class="pre">EmbeddedModelField</span></tt> can either be the class name
(<tt class="docutils literal"><span class="pre">Address</span></tt>) or a string containing the class name (<tt class="docutils literal"><span class="pre">'Address'</span></tt>).</p>
<p>Let&#8217;s add a customer to the database.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Customer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s">&#39;John&#39;</span><span class="p">,</span>
    <span class="n">address</span><span class="o">=</span><span class="n">Address</span><span class="p">(</span><span class="n">city</span><span class="o">=</span><span class="s">&#39;London&#39;</span><span class="p">,</span> <span class="n">street</span><span class="o">=</span><span class="s">&#39;Some street&#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The resulting data record can be inspected with the <a class="reference external" href="http://www.mongodb.org/display/DOCS/mongo+-+The+Interactive+Shell">MongoDB console</a>:</p>
<div class="highlight-js"><div class="highlight"><pre><span class="cm">/* db.docs_customer.findOne() */</span>
<span class="p">{</span>
    <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;4ce...&quot;</span><span class="p">),</span>
    <span class="s2">&quot;name&quot;</span> <span class="o">:</span> <span class="s2">&quot;John&quot;</span><span class="p">,</span>
    <span class="s2">&quot;address&quot;</span> <span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;city&quot;</span> <span class="o">:</span> <span class="s2">&quot;London&quot;</span><span class="p">,</span>
        <span class="s2">&quot;street&quot;</span> <span class="o">:</span> <span class="s2">&quot;Some street&quot;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As you see, the <em>address</em> is stored as a nested JSON/BSON object.</p>
</div>
<div class="section" id="embedded-objects-in-a-list">
<span id="embedded-objects-list"></span><h2>Embedded Objects in a List<a class="headerlink" href="#embedded-objects-in-a-list" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>It&#8217;s cool to use Embedded Objects in a list instead of relations:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">djangotoobox.fields</span> <span class="kn">import</span> <span class="n">EmbeddedModelField</span><span class="p">,</span> <span class="n">ListField</span>

<span class="k">class</span> <span class="nc">ModelA</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
   <span class="n">b</span> <span class="o">=</span> <span class="n">ListField</span><span class="p">(</span><span class="n">EmbeddedModelField</span><span class="p">(</span><span class="n">ModelB</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>If used in a list or dict or similar, Embedded Objects can be
a good or even better alternative to relations.</p>
<p>Imagine you&#8217;re a music store and you have those models:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">djangotoolbox.fields</span> <span class="kn">import</span> <span class="n">EmbeddedModelField</span><span class="p">,</span> <span class="n">ListField</span>

<span class="k">class</span> <span class="nc">Musician</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>
    <span class="n">albums</span> <span class="o">=</span> <span class="n">ListField</span><span class="p">(</span><span class="n">EmbeddedModelField</span><span class="p">(</span><span class="s">&#39;Album&#39;</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">Album</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>
    <span class="n">year</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
    <span class="n">tracks</span> <span class="o">=</span> <span class="n">ListField</span><span class="p">(</span><span class="n">EmbeddedModelField</span><span class="p">(</span><span class="s">&#39;Track&#39;</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">Track</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>
    <span class="n">length</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
</pre></div>
</div>
<p>Now let&#8217;s add a data record</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">dimmu</span><span class="o">=</span> <span class="n">Musician</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Dimmu Borgir&#39;</span><span class="p">)</span>
<span class="n">in_sorte_diaboli</span> <span class="o">=</span> <span class="n">Album</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s">&#39;In Sorte Diaboli&#39;</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="mi">2007</span><span class="p">,</span>
    <span class="n">tracks</span><span class="o">=</span><span class="p">[</span><span class="n">Track</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;The Serpentine Offering&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">309</span><span class="p">),</span>
            <span class="n">Track</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;The Chosen Legacy&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">257</span><span class="p">),</span>
            <span class="n">Track</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;The Conspiracy Unfolds&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">324</span><span class="p">)]</span>
<span class="p">)</span>
<span class="n">dimmu</span><span class="o">.</span><span class="n">albums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">in_sorte_diaboli</span><span class="p">)</span>
<span class="n">dimmu</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>and have a look at what BSON was generated by <em>django-mongodb-engine</em>:</p>
<div class="highlight-js"><div class="highlight"><pre><span class="cm">/* &gt; db.docs_musician.findOne() */</span>
<span class="p">{</span>
    <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;4cee2549e4721c3b2c000001&quot;</span><span class="p">),</span>
    <span class="s2">&quot;name&quot;</span> <span class="o">:</span> <span class="s2">&quot;Dimmu Borgir&quot;</span><span class="p">,</span>
    <span class="s2">&quot;albums&quot;</span> <span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;title&quot;</span> <span class="o">:</span> <span class="s2">&quot;In Sorte Diaboli&quot;</span><span class="p">,</span>
            <span class="s2">&quot;year&quot;</span> <span class="o">:</span> <span class="mi">2007</span><span class="p">,</span>
            <span class="s2">&quot;tracks&quot;</span> <span class="o">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;length&quot;</span> <span class="o">:</span> <span class="mi">309</span><span class="p">,</span>
                    <span class="s2">&quot;title&quot;</span> <span class="o">:</span> <span class="s2">&quot;The Serpentine Offering&quot;</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;length&quot;</span> <span class="o">:</span> <span class="mi">257</span><span class="p">,</span>
                    <span class="s2">&quot;title&quot;</span> <span class="o">:</span> <span class="s2">&quot;The Chosen Legacy&quot;</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;length&quot;</span> <span class="o">:</span> <span class="mi">324</span><span class="p">,</span>
                    <span class="s2">&quot;title&quot;</span> <span class="o">:</span> <span class="s2">&quot;The Conspiracy Unfolds&quot;</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Neat, isn&#8217;t it?</p>
<div class="section" id="keep-in-mind-auto-now-add-behaves-like-auto-now">
<h3>Keep in Mind: <tt class="docutils literal"><span class="pre">auto_now_add</span></tt> behaves like <tt class="docutils literal"><span class="pre">auto_now</span></tt><a class="headerlink" href="#keep-in-mind-auto-now-add-behaves-like-auto-now" title="Permalink to this headline">¶</a></h3>
<p>because there&#8217;s <a href="#id2"><span class="problematic" id="id3">`no difference between an insert and update`_</span></a> in MongoDB.</p>
</div>
</div>
<div class="section" id="keep-in-mind-no-reverse-relations">
<h2>Keep in Mind: No Reverse-Relations<a class="headerlink" href="#keep-in-mind-no-reverse-relations" title="Permalink to this headline">¶</a></h2>
<p>The model structure used above makes queries down the data tree easy, e.g.
<em>get me all albums by musician xy</em> or <em>get me all albums whose title starts with
an &#8216;a&#8217;</em>. You could even emulate queries like <em>get me all tracks of musician xy</em>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">sum</span><span class="p">((</span><span class="n">album</span><span class="o">.</span><span class="n">tracks</span> <span class="k">for</span> <span class="n">album</span> <span class="ow">in</span> <span class="n">Musician</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">xy</span><span class="p">)</span><span class="o">.</span><span class="n">album</span><span class="p">),</span> <span class="p">[])</span>
</pre></div>
</div>
<p>However, queries that would normally require reverse-JOINs are not possible.
For example, <em>get me all albums from 2005 with the related musicians</em> simply
is impossible on non-relational databases as such a query would require JOINs.
Emulation of such queries is possible but <strong>very expensive</strong> because you have
to crawl through the whole collection:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># VERY expensive and slow query. Don&#39;t do this!</span>
<span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">musician</span> <span class="ow">in</span> <span class="n">Musician</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
    <span class="n">musician</span><span class="o">.</span><span class="n">albums</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">album</span><span class="p">:</span><span class="n">album</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="mi">2005</span><span class="p">,</span> <span class="n">musician</span><span class="o">.</span><span class="n">albums</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">musician</span><span class="o">.</span><span class="n">albums</span><span class="p">:</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">musician</span><span class="p">)</span>
</pre></div>
</div>
<p class="rubric">What&#8217;s the point?</p>
<p>Consider your queries when designing your models.</p>
</div>
<div class="section" id="querying-and-updating-embedded-objects">
<span id="embedded-objects-queries"></span><h2>Querying and Updating Embedded Objects<a class="headerlink" href="#querying-and-updating-embedded-objects" title="Permalink to this headline">¶</a></h2>
<div class="section" id="querying">
<h3>Querying<a class="headerlink" href="#querying" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">A</span><span class="p">(</span><span class="s">&#39;subfield&#39;</span><span class="p">,</span> <span class="s">&#39;value&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>translates to the Mongo query</p>
<div class="last highlight-js"><div class="highlight"><pre><span class="p">.</span><span class="nx">find</span><span class="p">(</span> <span class="p">{</span><span class="s1">&#39;field.subfield&#39;</span> <span class="o">:</span> <span class="s1">&#39;value&#39;</span><span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<p>django-mongodb-engine has full support for
<a class="reference external" href="MongoDB'sembeddedobjects">queries and updates that reach into subobjects</a>
using the <tt class="xref py py-class docutils literal"><span class="pre">A</span></tt> query helper.</p>
<p>For example, <em>find any customer whose habitat is London</em>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django_mongodb_engine.query</span> <span class="kn">import</span> <span class="n">A</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Customer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Bob&#39;</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="n">Address</span><span class="p">(</span><span class="n">city</span><span class="o">=</span><span class="s">&#39;NY&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Customer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Ann&#39;</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="n">Address</span><span class="p">(</span><span class="n">city</span><span class="o">=</span><span class="s">&#39;London&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Customer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="n">A</span><span class="p">(</span><span class="s">&#39;city&#39;</span><span class="p">,</span> <span class="s">&#39;London&#39;</span><span class="p">))</span>
<span class="go">[&lt;Customer &#39;Ann&#39;&gt;]</span>
</pre></div>
</div>
<p>If you <a class="reference internal" href="faq.html#query-debugging"><em>enable query debugging</em></a>,
you can see what this query translates to:</p>
<div class="highlight-python"><pre>DEBUG [...] .find {'address.city': 'London'} [...]</pre>
</div>
<p>If you need to match multiple filters on the same embedded field, chain
<tt class="xref py py-meth docutils literal"><span class="pre">filter()</span></tt> calls:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Customer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="n">A</span><span class="p">(</span><span class="s">&#39;city&#39;</span><span class="p">,</span> <span class="s">&#39;London&#39;</span><span class="p">))</span> \
                <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="n">A</span><span class="p">(</span><span class="s">&#39;street&#39;</span><span class="p">,</span> <span class="s">&#39;Some street&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>This translates to:</p>
<div class="highlight-js"><div class="highlight"><pre><span class="p">.</span><span class="nx">find</span><span class="p">(</span> <span class="p">{</span><span class="s1">&#39;address.city&#39;</span><span class="o">:</span> <span class="s1">&#39;London&#39;</span><span class="p">,</span> <span class="s1">&#39;address.street&#39;</span><span class="o">:</span> <span class="s1">&#39;Some street&#39;</span><span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="updating">
<h3>Updating<a class="headerlink" href="#updating" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="s">&#39;bar&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">A</span><span class="p">(</span><span class="s">&#39;subfield&#39;</span><span class="p">,</span> <span class="s">&#39;new-value&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>translates to the Mongo query</p>
<div class="last highlight-js"><div class="highlight"><pre><span class="p">.</span><span class="nx">update</span><span class="p">(</span> <span class="p">{</span><span class="nx">foo</span><span class="o">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;$set&#39;</span> <span class="o">:</span> <span class="p">{</span><span class="s1">&#39;field.subfield&#39;</span> <span class="o">:</span> <span class="s1">&#39;new-value&#39;</span><span class="p">}}</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<p>Updating works similar to this, e.g. John moved to Houston:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Customer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;John&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">addresss</span><span class="o">=</span><span class="n">A</span><span class="p">(</span><span class="s">&#39;city&#39;</span><span class="p">,</span> <span class="s">&#39;Houston&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Translates to:</p>
<div class="highlight-js"><div class="highlight"><pre><span class="p">.</span><span class="nx">update</span><span class="p">(</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="o">:</span> <span class="s1">&#39;John&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;$set&#39;</span><span class="o">:</span> <span class="p">{</span><span class="s1">&#39;address.city&#39;</span><span class="o">:</span> <span class="s1">&#39;Houston&#39;</span><span class="p">}}</span> <span class="p">)</span>
</pre></div>
</div>
<p>Of course, <tt class="xref py py-class docutils literal"><span class="pre">A</span></tt> can be used for both filtering
and updating at the same time; for example, for moving all customers from
New York to Canasas:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Customer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="n">A</span><span class="p">(</span><span class="s">&#39;city&#39;</span><span class="p">,</span> <span class="s">&#39;NY&#39;</span><span class="p">))</span> \
                <span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="n">A</span><span class="p">(</span><span class="s">&#39;city&#39;</span><span class="p">,</span> <span class="s">&#39;Cansas&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Which translates to:</p>
<div class="highlight-js"><div class="highlight"><pre><span class="p">.</span><span class="nx">update</span><span class="p">(</span> <span class="p">{</span><span class="s1">&#39;address.city&#39;</span><span class="o">:</span> <span class="s1">&#39;NY&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;$set&#39;</span><span class="o">:</span> <span class="p">{</span><span class="s1">&#39;address.city&#39;</span><span class="o">:</span> <span class="s1">&#39;Cansas&#39;</span><span class="p">}}</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="lists-and-dicts.html" title="Storing Python Lists and Dicts"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="django-mongodb-engine – MongoDB Backend for Django"
             >previous</a> |</li>
        <li><a href="index.html">django-mongodb-engine v0.2.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2009-2010: Flavio Percoco, Alberto Paro, Jonas Haag &amp; contributors.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.4.
    </div>
  </body>
</html>